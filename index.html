<script>
const rosterNames = [
  "陳晨威","陳傑憲","S Fairchild","柯敬賢","宋晟睿",
  "林安可","邱志呈","林子偉","張育成","李灝宇",
  "鄭宗哲","J Long","江坤宇","吳念庭"
];

let dragged = null;
let ghost = null;

function createRoster() {
  const r = document.getElementById("roster");
  rosterNames.forEach(name => {
    const d = document.createElement("div");
    d.className = "item drag";
    d.textContent = name;
    enableDrag(d);
    r.appendChild(d);
  });
}

function createLineup() {
  const l = document.getElementById("lineup");
  for (let i = 1; i <= 9; i++) {
    const d = document.createElement("div");
    d.className = "item slot drop";
    d.innerHTML = `
      <div class="order">${i}</div>
      <div class="name"></div>
    `;
    l.appendChild(d);
  }
}

function enableDrag(el) {
  el.addEventListener("pointerdown", e => {
    dragged = el;

    ghost = el.cloneNode(true);
    ghost.className = "ghost";
    document.body.appendChild(ghost);
    moveGhost(e);

    el.setPointerCapture(e.pointerId);
  });

  el.addEventListener("pointermove", e => {
    if (ghost) moveGhost(e);
  });

  el.addEventListener("pointerup", e => {
    handleDrop(e);
    cleanup();
  });
}

function moveGhost(e) {
  ghost.style.left = e.clientX + "px";
  ghost.style.top = e.clientY + "px";
}

function handleDrop(e) {
  const target = document.elementFromPoint(e.clientX, e.clientY);
  const slot = target?.closest(".drop");
  if (!slot) return;

  const nameBox = slot.querySelector(".name");
  if (!nameBox) return;

  if (nameBox.textContent) {
    const temp = nameBox.textContent;
    nameBox.textContent = dragged.textContent;
    dragged.textContent = temp;
  } else {
    nameBox.textContent = dragged.textContent;
    dragged.remove();
  }
}

function cleanup() {
  if (ghost) ghost.remove();
  ghost = null;
  dragged = null;
}

createRoster();
createLineup();
</script>
